import{_,d as m,o as c,c as a,a as e,t as o,F as u,r as b,p as g,b as $}from"./index-e3ce2170.js";const y=m({name:"Page1",data(){return{symbol:"BTCUSDT",bids:null,asks:[],lastUpdateId:0,buffer:[],checkFirstE:!1,ws:null}},methods:{compareArrays(s,t,d,n){for(let i=0;i<t.length;i++){t[i].push(d);const h=s.findIndex(l=>l[0]==t[i][0]);h>=0?Number(t[i][1])==0?(this.$bus.emit("diffChange",`${n=="a"?"ask:":"bid:"} ${s[h][0]} ${s[h][1]} удалено`),s.splice(h,1),t.splice(i,1),i--):(Number(t[i][1])!=s[h][1]&&(this.$bus.emit("diffChange",`${n=="a"?"ask:":"bid:"} ${s[h][0]} ${s[h][1]} обновлено на ${t[i][0]} ${t[i][1]}`),s[h]=t[i]),t.splice(i,1),i--):Number(t[i][1]!=0)?this.$bus.emit("diffChange",`${n=="a"?"ask:":"bid:"} ${t[i][0]} ${t[i][1]} добавлено`):(t.splice(i,1),i--)}},checkeventdata(s,t,d,n){const i=s;if(this.compareArrays(t,i,d,n),t.push(...i),t.sort((h,l)=>l[0]-h[0]),t.length>5e3)for(;t.length>1e3;){let h=0;t.reduce((l,r,f)=>r[2]===void 0?(h=f,l):r[2]<l?(h=f,r[2]):l,t[0][2]),t.splice(h,1)}},eventProcess(s){this.lastUpdateId=s.u,this.checkeventdata(s.b,this.bids,s.E,"b"),console.log(this.bids.length),this.checkeventdata(s.a,this.asks,s.E,"a")},processBuffer(){for(const s in this.buffer)this.buffer[s].u<=this.lastUpdateId?this.buffer.splice(s,1):(this.test?(this.buffer[s].U=this.lastUpdateId+1)&&this.eventProcess(this.buffer[s]):this.buffer[s].U<=this.lastUpdateId+1&&this.buffer[s].u>=this.lastUpdateId+1&&(this.eventProcess(this.buffer[s]),this.test=!0),this.buffer.splice(s,1))},getSnap(){setTimeout(()=>{this.bids==null&&this.$binance.getOrderBook(this.symbol).then(s=>{this.bids=s.bids,this.asks=s.asks,this.lastUpdateId=s.lastUpdateId,this.buffer.length>2&&this.processBuffer()})},2500)},getWS(){this.ws==null&&(this.ws=this.$binance.subscribe(this.symbol)),this.ws.onmessage=function(s){const t=JSON.parse(s.data);t.e==="depthUpdate"&&t.s==this.symbol&&(this.buffer.push(t),this.lastUpdateId!==0&&this.buffer.length>2&&this.processBuffer())}.bind(this)}},mounted(){this.$bus.on("symbolChange",s=>{this.$binance.unsubscribe(this.symbol,this.ws),this.symbol=s,this.bids=null,this.asks=[],this.lastUpdateId=0,this.buffer=[],this.checkFirstE=!1,this.ws=null,this.getSnap(),this.getWS()}),this.getSnap(),this.getWS()}}),p=s=>(g("data-v-12853439"),s=s(),$(),s),I={class:"h-screen-10 d-flex justify-space-between visscroll"},k={class:"h-100"},U={class:"w-100 h-100 d-flex flex-column listmobile"},w=p(()=>e("thead",null,[e("tr",{class:"d-flex"},[e("th",null,"Price"),e("th",null,"Quantity"),e("th",{class:"total"},"Total")])],-1)),x={class:"w-100 h-95"},S={class:"d-flex"},B={class:"total"},C={class:"h-100"},P={class:"w-100 h-100 d-flex flex-column listmobile"},F=p(()=>e("thead",null,[e("tr",{class:"d-flex"},[e("th",null,"Price"),e("th",null,"Quantity"),e("th",{class:"total"},"Total")])],-1)),E={class:"w-100 h-95"},N={class:"d-flex"},T={class:"total"};function A(s,t,d,n,i,h){return c(),a("div",I,[e("div",k,[e("p",null,"Bids ("+o(s.symbol)+")",1),e("table",U,[w,e("tbody",x,[(c(!0),a(u,null,b(s.bids,l=>(c(),a("tr",S,[e("td",null,o(l[0]),1),e("td",null,o(l[1]),1),e("td",B,o((l[0]*l[1]).toFixed(5)),1)]))),256))])])]),e("div",C,[e("p",null,"Asks "+o(s.symbol),1),e("table",P,[F,e("tbody",E,[(c(!0),a(u,null,b(s.asks,l=>(c(),a("tr",N,[e("td",null,o(l[0]),1),e("td",null,o(l[1]),1),e("td",T,o((l[0]*l[1]).toFixed(5)),1)]))),256))])])])])}const D=_(y,[["render",A],["__scopeId","data-v-12853439"]]);export{D as default};
