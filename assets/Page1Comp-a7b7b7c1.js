import{_ as d,d as a,o as u,c as o,a as n}from"./index-4739f447.js";const b=a({name:"Page1",data(){return{symbol:"BTCUSDT",bids:null,asks:[],lastUpdateId:0,buffer:[],checkFirstE:!1,ws:null}},methods:{compareArrays(s,i,f,r){for(let t=0;t<i.length;t++){i[t].push(f);const e=s.findIndex(h=>h[0]==i[t][0]);e>=0?Number(i[t][1])==0?(this.$bus.emit("diffChange",`${r=="a"?"ask:":"bid:"} ${s[e][0]} ${s[e][1]} удалено`),s.splice(e,1),i.splice(t,1),t--):(Number(i[t][1])!=s[e][1]&&(this.$bus.emit("diffChange",`${r=="a"?"ask:":"bid:"} ${s[e][0]} ${s[e][1]} обновлено на ${i[t][0]} ${i[t][1]}`),s[e]=i[t]),i.splice(t,1),t--):Number(i[t][1]!=0)?this.$bus.emit("diffChange",`${r=="a"?"ask:":"bid:"} ${i[t][0]} ${i[t][1]} добавлено`):(i.splice(t,1),t--)}},checkeventdata(s,i,f,r){const t=s;if(this.compareArrays(i,t,f,r),i.push(...t),i.sort((e,h)=>e[0]<h[0]?-1:e.name>h.name?1:0),i.length>1e3)for(;i.length>1e3;){let e=0;i.reduce((h,c,l)=>c[2]===void 0?(e=l,h):c[2]<h?(e=l,c[2]):h,i[0][2]),i.splice(e,1)}},eventProcess(s){this.lastUpdateId=s.u,this.checkeventdata(s.b,this.bids,s.E,"b"),console.log(this.bids.length),this.checkeventdata(s.a,this.asks,s.E,"a")},processBuffer(){for(const s in this.buffer)this.buffer[s].u<=this.lastUpdateId?this.buffer.splice(s,1):(this.test?(this.buffer[s].U=this.lastUpdateId+1)&&this.eventProcess(this.buffer[s]):this.buffer[s].U<=this.lastUpdateId+1&&this.buffer[s].u>=this.lastUpdateId+1&&(this.eventProcess(this.buffer[s]),this.test=!0),this.buffer.splice(s,1))},subscribe(){setTimeout(()=>{this.bids==null&&this.$binance.getOrderBook(this.symbol).then(s=>{this.bids=s.bids,this.asks=s.asks,this.lastUpdateId=s.lastUpdateId,this.processBuffer()})},1100)}},mounted(){this.$bus.on("symbolChange",s=>{this.symbol=s,this.bids=null,this.asks=[],this.lastUpdateId=0,this.buffer=[],this.checkFirstE=!1,this.ws=null,this.subscribe()}),this.ws==null&&(this.ws=this.$binance.subscribe(this.symbol)),this.ws.onmessage=function(s){const i=JSON.parse(s.data);i.e==="depthUpdate"&&(this.buffer.push(i),this.lastUpdateId!==0&&this.processBuffer())}.bind(this),this.subscribe()}}),p={class:"h-screen-10 d-flex justify-space-between visscroll"},m=n('<div class="h-100 w-50"><p>Bids</p><div class="table w-100 h-100"><div><tr class="d-flex"><th>Price(USDT)</th><th>Quantity(BTC)</th><th>Total</th></tr></div><div class="w-100 tbody"></div></div></div><div class="h-100 w-50"><p>Asks</p><div class="table w-100 h-100"><div><tr class="d-flex"><th>Price(USDT)</th><th>Quantity(BTC)</th><th>Total</th></tr></div><div class="w-100 h-95 tbody"></div></div></div>',2),$=[m];function k(s,i,f,r,t,e){return u(),o("div",p,$)}const _=d(b,[["render",k]]);export{_ as default};
