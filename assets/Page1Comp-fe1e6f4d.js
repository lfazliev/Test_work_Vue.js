import{_,d as m,o as a,c,a as e,t as o,F as u,r as b,p as g,b as $}from"./index-31c76d79.js";const y=m({name:"Page1",data(){return{symbol:"BTCUSDT",bids:null,asks:[],lastUpdateId:0,buffer:[],checkFirstE:!1,ws:null}},methods:{compareArrays(s,t,n,f){for(let i=0;i<t.length;i++){t[i].push(n);const h=s.findIndex(l=>l[0]==t[i][0]);h>=0?Number(t[i][1])==0?(this.$bus.emit("diffChange",`${f=="a"?"ask:":"bid:"} ${s[h][0]} ${s[h][1]} удалено`),s.splice(h,1),t.splice(i,1),i--):(Number(t[i][1])!=s[h][1]&&(this.$bus.emit("diffChange",`${f=="a"?"ask:":"bid:"} ${s[h][0]} ${s[h][1]} обновлено на ${t[i][0]} ${t[i][1]}`),s[h]=t[i]),t.splice(i,1),i--):Number(t[i][1]!=0)?this.$bus.emit("diffChange",`${f=="a"?"ask:":"bid:"} ${t[i][0]} ${t[i][1]} добавлено`):(t.splice(i,1),i--)}},checkeventdata(s,t,n,f){const i=s;if(this.compareArrays(t,i,n,f),t.push(...i),t.sort((h,l)=>l[0]-h[0]),t.length>5e3)for(;t.length>1e3;){let h=0;t.reduce((l,d,r)=>d[2]===void 0?(h=r,l):d[2]<l?(h=r,d[2]):l,t[0][2]),t.splice(h,1)}},eventProcess(s){this.lastUpdateId=s.u,this.checkeventdata(s.b,this.bids,s.E,"b"),console.log(this.bids.length),this.checkeventdata(s.a,this.asks,s.E,"a")},processBuffer(){for(const s in this.buffer)this.buffer[s].u<=this.lastUpdateId?this.buffer.splice(s,1):(this.test?(this.buffer[s].U=this.lastUpdateId+1)&&this.eventProcess(this.buffer[s]):this.buffer[s].U<=this.lastUpdateId+1&&this.buffer[s].u>=this.lastUpdateId+1&&(this.eventProcess(this.buffer[s]),this.test=!0),this.buffer.splice(s,1))},getSnap(){setTimeout(()=>{this.bids==null&&this.$binance.getOrderBook(this.symbol).then(s=>{this.bids=s.bids,this.asks=s.asks,this.lastUpdateId=s.lastUpdateId,this.buffer.length>2&&this.processBuffer()})},2500)}},mounted(){this.$bus.on("symbolChange",s=>{this.$binance.unsubscribe(this.symbol,this.ws),this.symbol=s,this.bids=null,this.asks=[],this.lastUpdateId=0,this.buffer=[],this.checkFirstE=!1,this.ws=null,this.getSnap(),this.ws=this.$binance.subscribe(this.symbol),this.ws.onmessage=function(t){const n=JSON.parse(t.data);n.e==="depthUpdate"&&(this.buffer.push(n),this.lastUpdateId!==0&&this.buffer.length>2&&this.processBuffer())}.bind(this)}),this.ws==null&&(this.ws=this.$binance.subscribe(this.symbol)),this.ws.onmessage=function(s){const t=JSON.parse(s.data);t.e==="depthUpdate"&&(this.buffer.push(t),this.lastUpdateId!==0&&this.buffer.length>2&&this.processBuffer())}.bind(this),this.getSnap()}}),p=s=>(g("data-v-be2b28fd"),s=s(),$(),s),I={class:"h-screen-10 d-flex justify-space-between visscroll"},U={class:"h-100"},k={class:"w-100 h-100 d-flex flex-column"},w=p(()=>e("thead",null,[e("tr",{class:"d-flex"},[e("th",null,"Price"),e("th",null,"Quantity"),e("th",{class:"total"},"Total")])],-1)),x={class:"w-100 h-95"},B={class:"d-flex"},S={class:"total"},C={class:"h-100"},P={class:"w-100 h-100 d-flex flex-column"},F=p(()=>e("thead",null,[e("tr",{class:"d-flex"},[e("th",null,"Price"),e("th",null,"Quantity"),e("th",{class:"total"},"Total")])],-1)),N={class:"w-100 h-95"},E={class:"d-flex"},T={class:"total"};function A(s,t,n,f,i,h){return a(),c("div",I,[e("div",U,[e("p",null,"Bids ("+o(s.symbol)+")",1),e("table",k,[w,e("tbody",x,[(a(!0),c(u,null,b(s.bids,l=>(a(),c("tr",B,[e("td",null,o(l[0]),1),e("td",null,o(l[1]),1),e("td",S,o((l[0]*l[1]).toFixed(5)),1)]))),256))])])]),e("div",C,[e("p",null,"Asks "+o(s.symbol),1),e("table",P,[F,e("tbody",N,[(a(!0),c(u,null,b(s.asks,l=>(a(),c("tr",E,[e("td",null,o(l[0]),1),e("td",null,o(l[1]),1),e("td",T,o((l[0]*l[1]).toFixed(5)),1)]))),256))])])])])}const D=_(y,[["render",A],["__scopeId","data-v-be2b28fd"]]);export{D as default};
